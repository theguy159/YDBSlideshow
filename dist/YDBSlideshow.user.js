// ==UserScript==
// @name        YDBSlideshow
// @version     "0.1.0"
// @author      theguy159
// @description An YDB plugin for automatic slideshow on derpibooru.org
// @homepage    https://tehvoid.net
// @supportURL  https://github.com/theguy159/YDBSlideshow/issues
// @match       *://derpibooru.org/*
// @match       *://trixiebooru.org/*
// @match       *://www.derpibooru.org/*
// @match       *://www.trixiebooru.org/*
// @match       *://*.o53xo.orzgs6djmvrg633souxg64th.*.*/*
// @match       *://*.orzgs6djmvrg633souxg64th.*.*/*
// @match       *://*.o53xo.mrsxe4djmjxw64tvfzxxezy.*.*/*
// @match       *://*.mrsxe4djmjxw64tvfzxxezy.*.*/*
// @exclude     *://trixiebooru.org/*.json
// @exclude     *://derpibooru.org/*.json
// @exclude     *://www.trixiebooru.org/*.json
// @exclude     *://www.derpibooru.org/*.json
// @exclude     *://*.o53xo.orzgs6djmvrg633souxg64th.*.json
// @exclude     *://*.orzgs6djmvrg633souxg64th.*.json
// @exclude     *://*.o53xo.mrsxe4djmjxw64tvfzxxezy.*.json
// @exclude     *://*.mrsxe4djmjxw64tvfzxxezy.*.json
// @grant       GM_addStyle
// @require     https://github.com/stsyn/derpibooruscripts/raw/master/YouBooru/lib.js
// @downloadURL https://github.com/theguy159/YDBSlideshow/raw/master/dist/YDBSlideshow.user.js
// @updateURL   https://github.com/theguy159/YDBSlideshow/raw/master/dist/YDBSlideshow.meta.js
// ==/UserScript==

!function(e){var n={};function o(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=n,o.d=function(e,n,t){o.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,n){if(1&n&&(e=o(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(o.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var i in e)o.d(t,i,function(n){return e[n]}.bind(null,i));return t},o.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(n,"a",n),n},o.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},o.p="",o(o.s=5)}([function(e,n,o){"use strict";e.exports=function(e){var n=[];return n.toString=function(){return this.map((function(n){var o=function(e,n){var o=e[1]||"",t=e[3];if(!t)return o;if(n&&"function"==typeof btoa){var i=(l=t,d=btoa(unescape(encodeURIComponent(JSON.stringify(l)))),r="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(d),"/*# ".concat(r," */")),s=t.sources.map((function(e){return"/*# sourceURL=".concat(t.sourceRoot).concat(e," */")}));return[o].concat(s).concat([i]).join("\n")}var l,d,r;return[o].join("\n")}(n,e);return n[2]?"@media ".concat(n[2],"{").concat(o,"}"):o})).join("")},n.i=function(e,o){"string"==typeof e&&(e=[[null,e,""]]);for(var t={},i=0;i<this.length;i++){var s=this[i][0];null!=s&&(t[s]=!0)}for(var l=0;l<e.length;l++){var d=e[l];null!=d[0]&&t[d[0]]||(o&&!d[2]?d[2]=o:o&&(d[2]="(".concat(d[2],") and (").concat(o,")")),n.push(d))}},n}},function(e,n,o){var t=o(2);e.exports="string"==typeof t?t:t.toString()},function(e,n,o){(e.exports=o(0)(!1)).push([e.i,"#_ydb_ss_toggle_slideshow {\r\n  display: none;\r\n}\r\n",""])},function(e,n,o){var t=o(4);e.exports="string"==typeof t?t:t.toString()},function(e,n,o){(e.exports=o(0)(!1)).push([e.i,"#_ydb_ss_toggle_slideshow {\r\n  display: inline-block;\r\n}\r\n\r\n#_ydb_ss_toggle_slideshow_random {\r\n  z-index: 202;\r\n  position: relative;\r\n}\r\n#_ydb_ss_label_slideshow_random {\r\n  z-index: 202;\r\n  position: relative;\r\n  user-select: none;\r\n}\r\n",""])},function(e,n,o){"use strict";o.r(n);const t="Slideshow",i="YDBSlideshowConf",s="YDBSlideshowState",l="https://tehvoid.net",d=!1;function r(){let e;try{e=JSON.parse(localStorage[s])}catch(n){e={}}return e}function a(){let e;try{e=JSON.parse(localStorage[i])}catch(n){e={}}return e}function c(e){localStorage[s]=JSON.stringify(e)}function u(e){GM_addStyle(e)}function h(){const e=r(),n=a();let o=1e3*n.slideshowTimeout,t=(n.slideshowVideoSinglePlaybackThreshold,n.shouldSkipVideoTimeout,document.getElementsByClassName("js-rand")[0].href),i=document.getElementsByClassName("js-next")[0].href;e.slideshowEnabled&&(window.ydbSlideshowTimeout=setTimeout((function(){window.location=n.slideshowRandom?t:i}),o))}function f(){const e=r(),n=a();e.slideshowEnabled=!e.slideshowEnabled,c(e),e.slideshowEnabled?(n.slideshowFullscreen&&document.getElementById("_ydb_fs_enable").dispatchEvent(new MouseEvent("click")),h()):clearTimeout(window.ydbSlideshowTimeout)}function m(){const e=a();e.slideshowRandom=!e.slideshowRandom,function(e){localStorage[i]=JSON.stringify(e)}(e)}const p=o(1).toString(),_=o(3).toString();!function(){const e=a();null==unsafeWindow._YDB_public&&(unsafeWindow._YDB_public={}),null==unsafeWindow._YDB_public.settings&&(unsafeWindow._YDB_public.settings={}),function(){const e=r();void 0===e.slideshowEnabled&&(e.slideshowEnabled=!1),e.NU1||(e.NU1=!0,c(e))}(),function(){const e=a();void 0===e.slideshowTimeout&&(e.slideshowTimeout=15),void 0===e.slideshowVideoSinglePlaybackThreshold&&(e.slideshowVideoSinglePlaybackThreshold=15),void 0===e.shouldSkipVideoTimeout&&(e.shouldSkipVideoTimeout=!1),void 0===e.slideshowRandom&&(e.slideshowRandom=!1),void 0===e.slideshowFullscreen&&(e.slideshowFullscreen=!1),localStorage[i]=JSON.stringify(e)}(),unsafeWindow._YDB_public.settings.ydbSlideshow={name:t,container:i,version:"0.1.0",link:l,hidden:d,s:[{type:"input",name:"Slideshow timeout",parameter:"slideshowTimeout",validation:{type:"int",min:1,default:15}},{type:"input",name:"Slideshow video skip threshold (s)",parameter:"slideshowVideoSinglePlaybackThreshold",validation:{type:"int",default:15}},{type:"checkbox",name:"Skip to next if video is longer than the threshold",parameter:"shouldSkipVideoTimeout"},{type:"checkbox",name:"Random?",parameter:"slideshowRandom"},{type:"checkbox",name:"Auto fullscreen? (requires Resurrected Derp Fullscreen)",parameter:"slideshowFullscreen"}]},u(p),window.location.pathname.match(/^\/(images)?.\d{1}.*$/)&&u(_);const n={toggleSlideshow:addElem("a",{id:"_ydb_ss_toggle_slideshow",className:"header__link",innerHTML:"Toggle slideshow",events:[{t:"click",f:f}]},document.body),toggleSlideshowRandomLabel:addElem("label",{id:"_ydb_ss_label_slideshow_random",for:"_ydb_ss_toggle_slideshow_random",innerHTML:"Random slideshow? "},document.querySelector("#content>.block:first-child")),toggleSlideshowRandom:addElem("input",{id:"_ydb_ss_toggle_slideshow_random",type:"checkbox",checked:e.slideshowRandom,events:[{t:"click",f:m}]},document.querySelector("#content>.block:first-child")),disableFsButton:document.getElementById("_ydb_fs_disable")};document.getElementsByClassName("header__force-right")[0].insertBefore(n.toggleSlideshow,document.getElementsByClassName("header__force-right")[0].childNodes[0]),n.disableFsButton&&n.disableFsButton.addEventListener("click",()=>{window.ydbSlideshowTimeout&&f()}),h()}()}]);